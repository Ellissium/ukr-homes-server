// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  email    String @unique
  password String

  name       String @unique
  avatarPath String @default("/uploads/default-avatar.png") @map("avatar_path")

  phone            String             @default("")
  role             EnumUserRole       @default(USER)
  posts            Post[]
  favoritePosts    Post[]             @relation("UserFavoritePost")
  UserFavoritePost UserFavoritePost[]

  @@map("users")
}

model Post {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  activity       Boolean  @default(true)
  name           String   @unique
  slug           String   @unique
  images         String[]
  description    String
  price          Int
  utilitiesPrice Int      @map("utilities_price")

  region         String
  city           String
  street         String
  houseNumber    String @map("house_number")
  mapCoordinates String @map("map_coordinates")

  roomsNumber     Int @map("rooms_number")
  bedsNumber      Int @map("beds_number")
  bathroomsNumber Int @map("bathrooms_number")
  floor           Int
  area            Int
  minRentalPeriod Int @map("min_rental_period")

  category         Category           @relation(fields: [categoryId], references: [id])
  categoryId       Int                @map("category_id")
  author           User               @relation(fields: [authorId], references: [id])
  authorId         Int                @map("author_id")
  favoritedBy      User[]             @relation("UserFavoritePost")
  UserFavoritePost UserFavoritePost[]

  @@map("posts")
}

model Category {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  name String @unique
  slug String @unique
  Post Post[]

  @@map("categories")
}

model UserFavoritePost {
  id     Int  @id @default(autoincrement())
  user   User @relation(fields: [userId], references: [id])
  userId Int  @map("user_id")
  post   Post @relation(fields: [postId], references: [id])
  postId Int  @map("post_id")

  @@map("user_favorite_posts")
}

enum EnumUserRole {
  USER
  ADMIN
}
